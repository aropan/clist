{% load el_pagination_tags %}

{% lazy_paginate 50,200 problems %}

{% for problem in problems %}
{% if coder %}
{% get_problem_solution problem as solution %}

{% if problem.is_solved %}
{% define 'success' as solution_class %}
{% elif problem.is_reject %}
{% define 'danger' as solution_class %}
{% elif solution.result|is_solved %}
{% define 'success' as solution_class %}
{% elif solution.result.upsolving|is_solved %}
{% define 'success' as solution_class %}
{% elif solution.result|is_hidden %}
{% define 'warning' as solution_class %}
{% elif solution.result|is_reject %}
{% define 'danger' as solution_class %}
{% elif solution.result.partial %}
{% define 'info' as solution_class %}
{% else %}
{% define '' as solution_class %}
{% endif %}

{% endif %}
<tr class="show-hidden-activity-on-hover">
  <td class="problem-date-column">
    <div title="{{ problem.time|timezone:timezone|format_time:timeformat }}" data-toggle="tooltip">{{ problem.time|timezone:timezone|naturalday }}</div> </td>
  <td class="problem-rating-column">
    {% if problem.rating is not None %}
    {% coder_color_circle problem.resource problem.rating %}
    <span class="{% coder_color_class problem.resource problem.rating %}">
      {{ problem.rating }}
    </span>
    {% elif problem.resource.has_problem_rating and problem.n_total %}
    <i class="text-muted fa-xs fas fa-sync fa-spin"></i>
    {% else %}
    <span class="text-muted">&mdash;</span>
    {% endif %}
  </td>
  <td class="problem-progress-column">
    {% include 'standings_problem_progress.html' with problem=problem contest="" %}
  </td>
  {% if coder %}
  <td class="problem-luck-column">
    {% if problem.rating is not None and problem.account_rating is not None %}
    {% win_probability problem.rating problem.account_rating as prob %}
    {{ prob|multiply:100|floatformat:2 }}%
    {% endif %}
  </td>
  <td class="problem-result-column {{ solution_class }}" data-solution-class="{{ solution_class }}">
    {% if solution %}
      {% if not solution.result|is_solved and solution.result.upsolving %}
        {% include "standings_problem_stat.html" with statistic=solution.statistic stat=solution.result.upsolving with_detail=False key=solution.key with_admin_url=True is_upsolving=True %}
      {% else %}
        {% include "standings_problem_stat.html" with statistic=solution.statistic stat=solution.result with_detail=False key=solution.key with_admin_url=True %}
      {% endif %}
    {% endif %}
  </td>
  {% endif %}
  {% for field in custom_fields_select.values %}
  <td class="problem-field-column">
    {% with v=problem|get_item:field %}
    {% if v is None %}<span class="text-muted">&mdash;</span>{% else %}{{ v }}{% endif %}
    {% endwith %}
  </td>
  {% endfor %}
  <td class="problem-name-column {{ solution_class }}" data-solution-class="{{ solution_class }}">
    <span class="nowrap">
      <a href="{% url_transform request resource=problem.resource.id %}">
        <img data-toggle="tooltip" data-placement="top" title="{{ problem.resource.host }}" src="{{ problem.resource.icon|media_size:'32x32' }}" width="16" height="16"/>
      </a>
      {% if problem.url %}<a href="{{ problem.url }}" target="_blank" rel="noopener">{% endif %}
        {% trim_to problem.name 50 %}
      {% if problem.url %}</a>{% endif %}
      {% if favorite_problems %}{% activity_action "fav" problem %}{% endif %}
      <span class="hidden-activity">
      {% activity_action "tdo" problem callback="click_activity_problem_result" %}
      {% activity_action "sol" problem callback="click_activity_problem_result" %}
      {% activity_action "rej" problem callback="click_activity_problem_result" %}
      </span>
    </span>
    {% if perms.clist.change_problem %}
    <a href="{% url 'admin:clist_problem_change' problem.id %}" class="database-link invisible" target="_blank" rel="noopener"><i class="fas fa-database"></i></a>
    {% endif %}
    <span class="pull-right">
      {% for contest in problem.contests.all %}
      {% if forloop.counter0 %} |
      {% if forloop.counter0 == 1 %}
      <a onclick="return show_hidden_contests(this)" class="hidden-contests contests" title="{% for contest in problem.contests.all|slice:"1:" %}{{ contest.title }}<br/>{% endfor %}" data-toggle="tooltip" data-html="true">...</a>
      <span class="hidden">
        {% endif %}
        {% endif %}
        <a href="{{ contest.actual_url }}" class="contests">{% trim_to contest.title 25 %}</a>
        {% endfor %}
        {% if problem.contests.all|length > 1 %}
      </span>
      {% endif %}
    </span>
  </td>
  <td>
    {% for tag in problem.tags.all %}
    {% ifchanged %}<span class="hidden-tag unevent-hidden-tag badge progress-bar-info{% if show_tags %} hidden{% endif %}">&nbsp;</span>{% endifchanged %}
    <a href="{% url_transform request tag=tag.id %}" class="tag badge progress-bar-info{% if not show_tags %} hidden{% endif %}">{{ tag.name }}</a>
    {% endfor %}
  </td>
</tr>
{% endfor %}

{% show_more_table %}

<script>$(function() { $(window).trigger('resize') })</script> <!-- tags column auto width -->
<script>add_hidden_tag_event()</script>
