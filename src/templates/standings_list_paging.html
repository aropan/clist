{% if not without_paginate %}
{% load el_pagination_tags %}
{% lazy_paginate 50 contests %}
{% endif %}

{% for contest in contests %}
{% if contests_groups %}
{% include "standings_list_paging.html" with contests=contests_groups|get_item:contest.resource contests_groups=None group_contest=True without_paginate=True %}
{% endif %}

{% if not contest.has_module %}
{% define 'info' as status %}
{% elif contest.n_statistics is None and not contest.info.problems %}
{% define 'danger' as status %}
{% elif contest.is_running %}
{% define 'success' as status %}
{% else %}
{% define '' as status %}
{% endif %}

<tr class="contest{% if status %} {{ status }}{% endif %}{% if group_contest %} group-resource-{{ contest.resource.pk }}{% endif %}" {% if group_contest %}style="display: none"{% endif %}>
<td class="n_statistics text-muted">
  {% if contest.n_statistics %}
  <a href="{% url 'coder:accounts' %}?contest={{ contest.pk }}" class="{% if status %} text-{{ status }}{% endif %}">{{ contest.n_statistics }}</a>
  {% endif %}
</td>
<td class="n_problems text-muted">
  {% if not is_stage and contest.info.problems %}
  <a href="{% url 'clist:problems' %}?contest={{ contest.pk }}" class="{% if status %} text-{{ status }}{% endif %}">{{ contest.problems_list|to_list|length }}</a>
  {% endif %}
</td>
<td>
  <a href="{% url_transform request resource=contest.resource.id %}">
    <img data-toggle="tooltip" data-placement="top" title="{{ contest.resource.host }}" src="{{ contest.resource.icon|media_size:'32x32' }}" width="16" height="16"/>
  </a>
  {% if contest.invisible %}<i class="far fa-eye-slash"></i>{% endif %}
  {% if group_contest %}
    <span class="toggle" data-group=".group-resource-{{ contest.resource.pk }}"><i class="fa fa-caret-down"></i></span>
  {% endif %}

  <a href="{% url 'ranking:standings' contest.title|slug contest.pk %}" class="{% if status %} text-{{ status }}{% endif %}">
  {% trim_to contest.title 60 %}
  </a>

  {% if favorite_contests %}{% activity_action "fav" contest %}{% endif %}

  {% if contests_groups %}
    {% with group_size=contests_groups|get_item:contest.resource|length %}
    {% if group_size %}
      <span class="toggle badge progress-bar-info" data-group=".group-resource-{{ contest.resource.pk }}">{{ group_size }}&nbsp;<i class="fa fa-caret-down"></i></span>
    {% endif %}
    {% endwith %}
  {% endif %}

  {% for stat in contest.stats %}
  <span class="text-muted small">
    {% if stat.place %}
    {% with division=stat.addition|get_item:"division" %}
    Rank {{ stat.place }}{% if contest.n_statistics %} of {{ contest.info.problems.n_statistics|get_item:division|default:contest.n_statistics }}{% endif %}
    {% endwith %}
    {% endif %}

    {% with value=stat.addition.rating_change %}
    {% with intvalue=value|toint %}
      <span class="rating-change{% if intvalue %} rating-change-{% if intvalue > 0 %}up{% else %}down{% endif %}{% endif %}">
      {% if intvalue %}
        <i class="fas fa-angle-{% if intvalue > 0 %}up{% else %}down{% endif %}"></i>{{ intvalue|abs }}
      {% else %}
        {{ value }}
      {% endif %}
      </span>
    {% endwith %}
    {% endwith %}
  </span>
  {% endfor %}

  {% include "contest_inline_buttons.html" with contest=contest %}
</td>
<td class="date text-muted small">
  <span title="{{ contest.end_time|timezone:timezone|format_time:timeformat }}" data-toggle="tooltip">{{ contest.end_time|timezone:timezone|naturalday }}</span>
</td>
{% for more_field in params.more_fields %}
<td>
  {% with value=contest|get_item:more_field info_value=contest.info|get_item:more_field %}
  {% include "field_value.html" with value=value|default:info_value field=more_field %}
  {% endwith %}
</td>
{% endfor %}

</tr>
{% endfor %}

{% if not without_paginate %}
{% show_more_table %}
{% endif %}
